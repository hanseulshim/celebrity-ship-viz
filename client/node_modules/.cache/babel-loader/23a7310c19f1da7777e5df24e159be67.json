{"ast":null,"code":"import _objectSpread from \"/Users/hanseulshim/Projects/celebrity-ship-viz/node_modules/@babel/runtime/helpers/esm/objectSpread2\";\nimport _slicedToArray from \"/Users/hanseulshim/Projects/celebrity-ship-viz/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\nimport _objectWithoutProperties from \"/Users/hanseulshim/Projects/celebrity-ship-viz/node_modules/@babel/runtime/helpers/esm/objectWithoutProperties\";\nvar _jsxFileName = \"/Users/hanseulshim/Projects/celebrity-ship-viz/src/components/main/filters/sub-filters/DropdownMenu.js\";\nimport React, { useState, useContext, useEffect } from 'react';\nimport styled from 'styled-components';\nimport { store } from 'context/store';\nimport { useLazyQuery } from '@apollo/client';\nimport { GET_VISUAL_DECK_LIST } from 'graphql/queries';\nimport { getFilterVariables } from 'helper';\nimport { StyledMenu, StyledCheckbox, StyledDropdown } from 'components/common/StyledComponents';\nconst Button = styled.button`\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  color: ${props => props.theme.jungleMist};\n  background-color: ${props => props.theme.biscay};\n  padding: 0.5em 1em;\n  font-weight: 500;\n  font-size: 1rem;\n  border-radius: 2px;\n  cursor: pointer;\n  box-shadow: 0 2px 2px 0 rgba(0, 0, 0, 0.24), 0 0 2px 0 rgba(0, 0, 0, 0.12);\n`;\nconst ApplyButton = styled.button`\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  color: ${props => props.theme.white};\n  background-color: ${props => props.theme.biscay};\n  padding: 0.25em 0.25em;\n  font-weight: 500;\n  font-size: 0.75rem;\n  border-radius: 2px;\n  cursor: pointer;\n  min-width: 50px;\n  box-shadow: 0 2px 2px 0 rgba(0, 0, 0, 0.24), 0 0 2px 0 rgba(0, 0, 0, 0.12);\n`;\n\nconst DropdownMenu = (_ref) => {\n  let options = _ref.options,\n      title = _ref.title,\n      displayKey = _ref.displayKey,\n      props = _objectWithoutProperties(_ref, [\"options\", \"title\", \"displayKey\"]);\n\n  const _useState = useState(false),\n        _useState2 = _slicedToArray(_useState, 2),\n        visible = _useState2[0],\n        setVisible = _useState2[1];\n\n  const globalState = useContext(store);\n  const state = globalState.state,\n        dispatch = globalState.dispatch;\n  const selectedShip = state.selectedShip,\n        selectedProduct = state.selectedProduct,\n        selectedItinerary = state.selectedItinerary,\n        selectedSailDate = state.selectedSailDate,\n        selectedBookingWeek = state.selectedBookingWeek,\n        peerGroupFilters = state.peerGroupFilters,\n        selectedPeerShip = state.selectedPeerShip,\n        selectedPeerProduct = state.selectedPeerProduct,\n        selectedPeerSailingDates = state.selectedPeerSailingDates,\n        filter = state.filter,\n        peerFilter = state.peerFilter,\n        filterCount = state.filterCount;\n\n  const _useLazyQuery = useLazyQuery(GET_VISUAL_DECK_LIST, {\n    onCompleted: data => {\n      dispatch({\n        type: 'setShipData',\n        value: data.deckVisualList\n      });\n    },\n    fetchPolicy: 'network-only'\n  }),\n        _useLazyQuery2 = _slicedToArray(_useLazyQuery, 1),\n        applyFilters = _useLazyQuery2[0]; // keep local state array for save button\n\n\n  const _useState3 = useState(filter[title]),\n        _useState4 = _slicedToArray(_useState3, 2),\n        subFilter = _useState4[0],\n        setSubFilter = _useState4[1];\n\n  useEffect(() => {\n    setSubFilter(filter[title]);\n  }, [filter, title]);\n\n  const handleCheck = ({\n    id,\n    value\n  }) => {\n    const foundFilter = subFilter.find(v => v.id === id);\n\n    if (foundFilter) {\n      setSubFilter(subFilter.filter(v => v.id !== id));\n    } else {\n      setSubFilter([...subFilter, {\n        id,\n        value\n      }]);\n    }\n  };\n\n  const handleSave = e => {\n    if (e.key === 'save') {\n      dispatch({\n        type: 'setSelectedSubFilter',\n        title,\n        value: subFilter\n      });\n\n      const filterCopy = _objectSpread({}, filter);\n\n      setVisible(false);\n      filterCopy[title] = subFilter;\n      applyFilters({\n        variables: getFilterVariables(selectedShip.id, selectedSailDate.id, selectedBookingWeek, selectedProduct.id, selectedItinerary.id, peerGroupFilters, selectedPeerShip, selectedPeerProduct.id, selectedPeerSailingDates[0], selectedPeerSailingDates[1], filterCopy, peerFilter, filterCount)\n      });\n    }\n  };\n\n  const handleVisibleChange = v => {\n    setVisible(v);\n\n    if (!v) {\n      setSubFilter(filter[title]);\n    }\n  };\n\n  const formatTitle = s => {\n    const split = s.replace(/([a-z](?=[A-Z]))/g, '$1 ');\n    return split.charAt(0).toUpperCase() + split.slice(1);\n  };\n\n  const menu = React.createElement(StyledMenu, {\n    onClick: handleSave,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 123\n    },\n    __self: this\n  }, options.map((option, i) => React.createElement(StyledMenu.Item, {\n    key: 'option' + i,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 125\n    },\n    __self: this\n  }, React.createElement(StyledCheckbox, {\n    onChange: () => handleCheck(option),\n    checked: !!subFilter.find(f => f.id === option.id),\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 126\n    },\n    __self: this\n  }, option[displayKey]))), React.createElement(StyledMenu.Item, {\n    key: \"save\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 134\n    },\n    __self: this\n  }, React.createElement(ApplyButton, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 135\n    },\n    __self: this\n  }, \"Apply\")));\n  return React.createElement(StyledDropdown, {\n    overlay: menu,\n    onVisibleChange: handleVisibleChange,\n    visible: visible,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 141\n    },\n    __self: this\n  }, React.createElement(Button, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 146\n    },\n    __self: this\n  }, formatTitle(title)));\n};\n\nexport default DropdownMenu;","map":{"version":3,"sources":["/Users/hanseulshim/Projects/celebrity-ship-viz/src/components/main/filters/sub-filters/DropdownMenu.js"],"names":["React","useState","useContext","useEffect","styled","store","useLazyQuery","GET_VISUAL_DECK_LIST","getFilterVariables","StyledMenu","StyledCheckbox","StyledDropdown","Button","button","props","theme","jungleMist","biscay","ApplyButton","white","DropdownMenu","options","title","displayKey","visible","setVisible","globalState","state","dispatch","selectedShip","selectedProduct","selectedItinerary","selectedSailDate","selectedBookingWeek","peerGroupFilters","selectedPeerShip","selectedPeerProduct","selectedPeerSailingDates","filter","peerFilter","filterCount","onCompleted","data","type","value","deckVisualList","fetchPolicy","applyFilters","subFilter","setSubFilter","handleCheck","id","foundFilter","find","v","handleSave","e","key","filterCopy","variables","handleVisibleChange","formatTitle","s","split","replace","charAt","toUpperCase","slice","menu","map","option","i","f"],"mappings":"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","sourcesContent":["import React, { useState, useContext, useEffect } from 'react'\nimport styled from 'styled-components'\nimport { store } from 'context/store'\nimport { useLazyQuery } from '@apollo/client'\n\nimport { GET_VISUAL_DECK_LIST } from 'graphql/queries'\nimport { getFilterVariables } from 'helper'\nimport {\n  StyledMenu,\n  StyledCheckbox,\n  StyledDropdown\n} from 'components/common/StyledComponents'\n\nconst Button = styled.button`\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  color: ${props => props.theme.jungleMist};\n  background-color: ${props => props.theme.biscay};\n  padding: 0.5em 1em;\n  font-weight: 500;\n  font-size: 1rem;\n  border-radius: 2px;\n  cursor: pointer;\n  box-shadow: 0 2px 2px 0 rgba(0, 0, 0, 0.24), 0 0 2px 0 rgba(0, 0, 0, 0.12);\n`\n\nconst ApplyButton = styled.button`\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  color: ${props => props.theme.white};\n  background-color: ${props => props.theme.biscay};\n  padding: 0.25em 0.25em;\n  font-weight: 500;\n  font-size: 0.75rem;\n  border-radius: 2px;\n  cursor: pointer;\n  min-width: 50px;\n  box-shadow: 0 2px 2px 0 rgba(0, 0, 0, 0.24), 0 0 2px 0 rgba(0, 0, 0, 0.12);\n`\n\nconst DropdownMenu = ({ options, title, displayKey, ...props }) => {\n  const [visible, setVisible] = useState(false)\n  const globalState = useContext(store)\n  const { state, dispatch } = globalState\n  const {\n    selectedShip,\n    selectedProduct,\n    selectedItinerary,\n    selectedSailDate,\n    selectedBookingWeek,\n    peerGroupFilters,\n    selectedPeerShip,\n    selectedPeerProduct,\n    selectedPeerSailingDates,\n    filter,\n    peerFilter,\n    filterCount\n  } = state\n  const [applyFilters] = useLazyQuery(GET_VISUAL_DECK_LIST, {\n    onCompleted: data => {\n      dispatch({ type: 'setShipData', value: data.deckVisualList })\n    },\n    fetchPolicy: 'network-only'\n  })\n\n  // keep local state array for save button\n  const [subFilter, setSubFilter] = useState(filter[title])\n\n  useEffect(() => {\n    setSubFilter(filter[title])\n  }, [filter, title])\n\n  const handleCheck = ({ id, value }) => {\n    const foundFilter = subFilter.find(v => v.id === id)\n    if (foundFilter) {\n      setSubFilter(subFilter.filter(v => v.id !== id))\n    } else {\n      setSubFilter([...subFilter, { id, value }])\n    }\n  }\n\n  const handleSave = e => {\n    if (e.key === 'save') {\n      dispatch({ type: 'setSelectedSubFilter', title, value: subFilter })\n      const filterCopy = { ...filter }\n      setVisible(false)\n      filterCopy[title] = subFilter\n      applyFilters({\n        variables: getFilterVariables(\n          selectedShip.id,\n          selectedSailDate.id,\n          selectedBookingWeek,\n          selectedProduct.id,\n          selectedItinerary.id,\n          peerGroupFilters,\n          selectedPeerShip,\n          selectedPeerProduct.id,\n          selectedPeerSailingDates[0],\n          selectedPeerSailingDates[1],\n          filterCopy,\n          peerFilter,\n          filterCount\n        )\n      })\n    }\n  }\n\n  const handleVisibleChange = v => {\n    setVisible(v)\n    if (!v) {\n      setSubFilter(filter[title])\n    }\n  }\n\n  const formatTitle = s => {\n    const split = s.replace(/([a-z](?=[A-Z]))/g, '$1 ')\n    return split.charAt(0).toUpperCase() + split.slice(1)\n  }\n\n  const menu = (\n    <StyledMenu onClick={handleSave}>\n      {options.map((option, i) => (\n        <StyledMenu.Item key={'option' + i}>\n          <StyledCheckbox\n            onChange={() => handleCheck(option)}\n            checked={!!subFilter.find(f => f.id === option.id)}\n          >\n            {option[displayKey]}\n          </StyledCheckbox>\n        </StyledMenu.Item>\n      ))}\n      <StyledMenu.Item key=\"save\">\n        <ApplyButton>Apply</ApplyButton>\n      </StyledMenu.Item>\n    </StyledMenu>\n  )\n\n  return (\n    <StyledDropdown\n      overlay={menu}\n      onVisibleChange={handleVisibleChange}\n      visible={visible}\n    >\n      <Button>{formatTitle(title)}</Button>\n    </StyledDropdown>\n  )\n}\n\nexport default DropdownMenu\n"]},"metadata":{},"sourceType":"module"}