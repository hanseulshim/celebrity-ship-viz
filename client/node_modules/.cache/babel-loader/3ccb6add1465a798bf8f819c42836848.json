{"ast":null,"code":"import _objectSpread from\"/Users/hanseulshim/Projects/celebrity-ship-viz/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _toConsumableArray from\"/Users/hanseulshim/Projects/celebrity-ship-viz/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _slicedToArray from\"/Users/hanseulshim/Projects/celebrity-ship-viz/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import _objectWithoutProperties from\"/Users/hanseulshim/Projects/celebrity-ship-viz/node_modules/@babel/runtime/helpers/esm/objectWithoutProperties\";import _taggedTemplateLiteral from\"/Users/hanseulshim/Projects/celebrity-ship-viz/node_modules/@babel/runtime/helpers/esm/taggedTemplateLiteral\";function _templateObject4(){var data=_taggedTemplateLiteral([\"\"]);_templateObject4=function _templateObject4(){return data;};return data;}function _templateObject3(){var data=_taggedTemplateLiteral([\"\\n  max-height: 300px;\\n  overflow: scroll;\\n\"]);_templateObject3=function _templateObject3(){return data;};return data;}function _templateObject2(){var data=_taggedTemplateLiteral([\"\\n  display: flex;\\n  justify-content: center;\\n  align-items: center;\\n  color: \",\";\\n  background-color: \",\";\\n  padding: 0.25em 0.25em;\\n  font-weight: 500;\\n  font-size: 0.75rem;\\n  border-radius: 2px;\\n  cursor: pointer;\\n  min-width: 50px;\\n  box-shadow: 0 2px 2px 0 rgba(0, 0, 0, 0.24), 0 0 2px 0 rgba(0, 0, 0, 0.12);\\n\"]);_templateObject2=function _templateObject2(){return data;};return data;}function _templateObject(){var data=_taggedTemplateLiteral([\"\\n  display: flex;\\n  justify-content: center;\\n  align-items: center;\\n  color: \",\";\\n  background-color: \",\";\\n  padding: 0.5em 1em;\\n  font-weight: 500;\\n  font-size: 1rem;\\n  border-radius: 2px;\\n  cursor: pointer;\\n  box-shadow: 0 2px 2px 0 rgba(0, 0, 0, 0.24), 0 0 2px 0 rgba(0, 0, 0, 0.12);\\n\"]);_templateObject=function _templateObject(){return data;};return data;}import React,{useState,useContext,useEffect}from'react';import styled from'styled-components';import{store}from'context/store';import{useLazyQuery}from'@apollo/client';import{Menu,Dropdown,Checkbox}from'antd';import{GET_VISUAL_DECK_LIST}from'graphql/queries';import{getFilterVariables}from'helper';var Button=styled.button(_templateObject(),function(props){return props.theme.white;},function(props){return props.theme.biscay;});var ApplyButton=styled.button(_templateObject2(),function(props){return props.theme.white;},function(props){return props.theme.biscay;});var StyledMenu=styled(Menu)(_templateObject3());var StyledCheckbox=styled(Checkbox)(_templateObject4());var PeerDropdownMenu=function PeerDropdownMenu(_ref){var options=_ref.options,title=_ref.title,displayKey=_ref.displayKey,props=_objectWithoutProperties(_ref,[\"options\",\"title\",\"displayKey\"]);var _useState=useState(false),_useState2=_slicedToArray(_useState,2),visible=_useState2[0],setVisible=_useState2[1];var globalState=useContext(store);var state=globalState.state,dispatch=globalState.dispatch;var selectedShip=state.selectedShip,selectedProduct=state.selectedProduct,selectedItinerary=state.selectedItinerary,selectedSailDate=state.selectedSailDate,selectedBookingWeek=state.selectedBookingWeek,peerGroupFilters=state.peerGroupFilters,selectedPeerShip=state.selectedPeerShip,selectedPeerProduct=state.selectedPeerProduct,selectedPeerSailingDates=state.selectedPeerSailingDates,filter=state.filter,peerFilter=state.peerFilter,filterCount=state.filterCount;var _useLazyQuery=useLazyQuery(GET_VISUAL_DECK_LIST,{onCompleted:function onCompleted(data){dispatch({type:'setShipData',value:data.deckVisualList});},fetchPolicy:'network-only'}),_useLazyQuery2=_slicedToArray(_useLazyQuery,1),applyFilters=_useLazyQuery2[0];// keep local state array for save button\nvar _useState3=useState(peerFilter[title]),_useState4=_slicedToArray(_useState3,2),subFilter=_useState4[0],setSubFilter=_useState4[1];useEffect(function(){setSubFilter(peerFilter[title]);},[peerFilter,title]);var handleCheck=function handleCheck(_ref2){var id=_ref2.id,value=_ref2.value;var foundFilter=subFilter.find(function(v){return v.id===id;});if(foundFilter){setSubFilter(subFilter.filter(function(v){return v.id!==id;}));}else{setSubFilter([].concat(_toConsumableArray(subFilter),[{id:id,value:value}]));}};var handleSave=function handleSave(e){if(e.key==='save'){dispatch({type:'setSelectedPeerSubFilter',title:title,value:subFilter});var peerFilterCopy=_objectSpread({},peerFilter);setVisible(false);peerFilterCopy[title]=subFilter;applyFilters({variables:getFilterVariables(selectedShip.id,selectedSailDate.id,selectedBookingWeek,selectedProduct.id,selectedItinerary.id,peerGroupFilters,selectedPeerShip,selectedPeerProduct.id,selectedPeerSailingDates[0],selectedPeerSailingDates[1],filter,peerFilterCopy,filterCount)});}};var handleVisibleChange=function handleVisibleChange(v){setVisible(v);if(!v){setSubFilter(peerFilter[title]);}};var formatTitle=function formatTitle(s){var split=s.replace(/([a-z](?=[A-Z]))/g,'$1 ');return split.charAt(0).toUpperCase()+split.slice(1);};var menu=React.createElement(StyledMenu,{onClick:handleSave},options.map(function(option,i){return React.createElement(Menu.Item,{key:'option'+i},React.createElement(StyledCheckbox,{onChange:function onChange(){return handleCheck(option);},checked:!!subFilter.find(function(f){return f.id===option.id;})},option[displayKey]));}),React.createElement(Menu.Item,{key:\"save\"},React.createElement(ApplyButton,null,\"Apply\")));return React.createElement(Dropdown,{overlay:menu,onVisibleChange:handleVisibleChange,visible:visible},React.createElement(Button,null,formatTitle(title)));};export default PeerDropdownMenu;","map":{"version":3,"sources":["/Users/hanseulshim/Projects/celebrity-ship-viz/src/components/main/filters/peer-group-filters/PeerDropdownMenu.js"],"names":["React","useState","useContext","useEffect","styled","store","useLazyQuery","Menu","Dropdown","Checkbox","GET_VISUAL_DECK_LIST","getFilterVariables","Button","button","props","theme","white","biscay","ApplyButton","StyledMenu","StyledCheckbox","PeerDropdownMenu","options","title","displayKey","visible","setVisible","globalState","state","dispatch","selectedShip","selectedProduct","selectedItinerary","selectedSailDate","selectedBookingWeek","peerGroupFilters","selectedPeerShip","selectedPeerProduct","selectedPeerSailingDates","filter","peerFilter","filterCount","onCompleted","data","type","value","deckVisualList","fetchPolicy","applyFilters","subFilter","setSubFilter","handleCheck","id","foundFilter","find","v","handleSave","e","key","peerFilterCopy","variables","handleVisibleChange","formatTitle","s","split","replace","charAt","toUpperCase","slice","menu","map","option","i","f"],"mappings":"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","sourcesContent":["import React, { useState, useContext, useEffect } from 'react'\nimport styled from 'styled-components'\nimport { store } from 'context/store'\nimport { useLazyQuery } from '@apollo/client'\nimport { Menu, Dropdown, Checkbox } from 'antd'\nimport { GET_VISUAL_DECK_LIST } from 'graphql/queries'\nimport { getFilterVariables } from 'helper'\n\nconst Button = styled.button`\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  color: ${props => props.theme.white};\n  background-color: ${props => props.theme.biscay};\n  padding: 0.5em 1em;\n  font-weight: 500;\n  font-size: 1rem;\n  border-radius: 2px;\n  cursor: pointer;\n  box-shadow: 0 2px 2px 0 rgba(0, 0, 0, 0.24), 0 0 2px 0 rgba(0, 0, 0, 0.12);\n`\n\nconst ApplyButton = styled.button`\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  color: ${props => props.theme.white};\n  background-color: ${props => props.theme.biscay};\n  padding: 0.25em 0.25em;\n  font-weight: 500;\n  font-size: 0.75rem;\n  border-radius: 2px;\n  cursor: pointer;\n  min-width: 50px;\n  box-shadow: 0 2px 2px 0 rgba(0, 0, 0, 0.24), 0 0 2px 0 rgba(0, 0, 0, 0.12);\n`\n\nconst StyledMenu = styled(Menu)`\n  max-height: 300px;\n  overflow: scroll;\n`\n\nconst StyledCheckbox = styled(Checkbox)``\n\nconst PeerDropdownMenu = ({ options, title, displayKey, ...props }) => {\n  const [visible, setVisible] = useState(false)\n  const globalState = useContext(store)\n  const { state, dispatch } = globalState\n  const {\n    selectedShip,\n    selectedProduct,\n    selectedItinerary,\n    selectedSailDate,\n    selectedBookingWeek,\n    peerGroupFilters,\n    selectedPeerShip,\n    selectedPeerProduct,\n    selectedPeerSailingDates,\n    filter,\n    peerFilter,\n    filterCount\n  } = state\n  const [applyFilters] = useLazyQuery(GET_VISUAL_DECK_LIST, {\n    onCompleted: data => {\n      dispatch({ type: 'setShipData', value: data.deckVisualList })\n    },\n    fetchPolicy: 'network-only'\n  })\n\n  // keep local state array for save button\n  const [subFilter, setSubFilter] = useState(peerFilter[title])\n\n  useEffect(() => {\n    setSubFilter(peerFilter[title])\n  }, [peerFilter, title])\n\n  const handleCheck = ({ id, value }) => {\n    const foundFilter = subFilter.find(v => v.id === id)\n    if (foundFilter) {\n      setSubFilter(subFilter.filter(v => v.id !== id))\n    } else {\n      setSubFilter([...subFilter, { id, value }])\n    }\n  }\n\n  const handleSave = e => {\n    if (e.key === 'save') {\n      dispatch({ type: 'setSelectedPeerSubFilter', title, value: subFilter })\n      const peerFilterCopy = { ...peerFilter }\n      setVisible(false)\n      peerFilterCopy[title] = subFilter\n      applyFilters({\n        variables: getFilterVariables(\n          selectedShip.id,\n          selectedSailDate.id,\n          selectedBookingWeek,\n          selectedProduct.id,\n          selectedItinerary.id,\n          peerGroupFilters,\n          selectedPeerShip,\n          selectedPeerProduct.id,\n          selectedPeerSailingDates[0],\n          selectedPeerSailingDates[1],\n          filter,\n          peerFilterCopy,\n          filterCount\n        )\n      })\n    }\n  }\n\n  const handleVisibleChange = v => {\n    setVisible(v)\n    if (!v) {\n      setSubFilter(peerFilter[title])\n    }\n  }\n\n  const formatTitle = s => {\n    const split = s.replace(/([a-z](?=[A-Z]))/g, '$1 ')\n    return split.charAt(0).toUpperCase() + split.slice(1)\n  }\n\n  const menu = (\n    <StyledMenu onClick={handleSave}>\n      {options.map((option, i) => (\n        <Menu.Item key={'option' + i}>\n          <StyledCheckbox\n            onChange={() => handleCheck(option)}\n            checked={!!subFilter.find(f => f.id === option.id)}\n          >\n            {option[displayKey]}\n          </StyledCheckbox>\n        </Menu.Item>\n      ))}\n      <Menu.Item key=\"save\">\n        <ApplyButton>Apply</ApplyButton>\n      </Menu.Item>\n    </StyledMenu>\n  )\n\n  return (\n    <Dropdown\n      overlay={menu}\n      onVisibleChange={handleVisibleChange}\n      visible={visible}\n    >\n      <Button>{formatTitle(title)}</Button>\n    </Dropdown>\n  )\n}\n\nexport default PeerDropdownMenu\n"]},"metadata":{},"sourceType":"module"}