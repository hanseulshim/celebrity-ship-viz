{"ast":null,"code":"import _slicedToArray from \"/Users/hanseulshim/Projects/celebrity-ship-viz/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\nvar _jsxFileName = \"/Users/hanseulshim/Projects/celebrity-ship-viz/src/components/main/filters/main-filters/CsvDownload.js\";\nimport React, { useContext, useEffect, useState } from 'react';\nimport { store } from 'context/store';\nimport styled from 'styled-components';\nimport Icon from 'components/common/Icon';\nconst Download = styled.button`\n  background-color: #80cbc4;\n  margin-left: auto;\n  color: ${props => props.theme.black};\n  padding: 0.5em 2em;\n  border-radius: 3px;\n\n  &:hover {\n    cursor: pointer;\n  }\n`;\n\nconst CsvDownload = () => {\n  const globalState = useContext(store);\n  const state = globalState.state;\n  const shipData = state.shipData;\n\n  const _useState = useState([]),\n        _useState2 = _slicedToArray(_useState, 2),\n        data = _useState2[0],\n        setData = _useState2[1];\n\n  useEffect(() => {\n    const decks = Object.keys(shipData);\n    const flatData = decks.map(deck => shipData[deck]).flat();\n    const peerGroupData = flatData.length !== 0 && Object.prototype.hasOwnProperty.call(flatData[0], 'category');\n    const data = flatData.map(row => {\n      const obj = {\n        deck: row.deck,\n        cabinNumber: row.cabinNumber,\n        bookingStatus: row.bookingStatus,\n        cabinCapacity: row.cabinCapacity,\n        bookedOccupancy: row.bookedOccupancy\n      };\n\n      if (peerGroupData) {\n        obj.category = row.category;\n        obj.selectedPercent = row.selectedPercent;\n        obj.peerGroupPercent = row.peerGroupPercent;\n        obj.difference = row.difference;\n      }\n\n      return obj;\n    });\n    setData(data);\n  }, [shipData]);\n\n  const generateCsv = () => {\n    const csvRows = [];\n    const headers = Object.keys(data[0]);\n    csvRows.push(headers.map(header => `\"${('' + header).replace(/\"/g, '\\\\\"')}\"`).join(','));\n\n    for (const row of data) {\n      csvRows.push(headers.map(header => `\"${('' + row[header]).replace(/\"/g, '\\\\\"')}\"`).join(','));\n    }\n\n    const csvData = csvRows.join('\\n');\n    const blob = new Blob([csvData], {\n      type: 'text/csv'\n    });\n    const url = window.URL.createObjectURL(blob);\n    const a = document.createElement('a');\n    a.setAttribute('hidden', '');\n    a.setAttribute('href', url);\n    a.setAttribute('download', 'shipData.csv');\n    document.body.appendChild(a);\n    a.click();\n    document.body.removeChild(a);\n  };\n\n  if (!data.length) return null;\n  return React.createElement(Download, {\n    onClick: () => generateCsv(),\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 75\n    },\n    __self: this\n  }, React.createElement(Icon, {\n    icon: \"download\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 76\n    },\n    __self: this\n  }), \"Download CSV\");\n};\n\nexport default CsvDownload;","map":{"version":3,"sources":["/Users/hanseulshim/Projects/celebrity-ship-viz/src/components/main/filters/main-filters/CsvDownload.js"],"names":["React","useContext","useEffect","useState","store","styled","Icon","Download","button","props","theme","black","CsvDownload","globalState","state","shipData","data","setData","decks","Object","keys","flatData","map","deck","flat","peerGroupData","length","prototype","hasOwnProperty","call","row","obj","cabinNumber","bookingStatus","cabinCapacity","bookedOccupancy","category","selectedPercent","peerGroupPercent","difference","generateCsv","csvRows","headers","push","header","replace","join","csvData","blob","Blob","type","url","window","URL","createObjectURL","a","document","createElement","setAttribute","body","appendChild","click","removeChild"],"mappings":"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","sourcesContent":["import React, { useContext, useEffect, useState } from 'react'\nimport { store } from 'context/store'\nimport styled from 'styled-components'\nimport Icon from 'components/common/Icon'\n\nconst Download = styled.button`\n  background-color: #80cbc4;\n  margin-left: auto;\n  color: ${props => props.theme.black};\n  padding: 0.5em 2em;\n  border-radius: 3px;\n\n  &:hover {\n    cursor: pointer;\n  }\n`\n\nconst CsvDownload = () => {\n  const globalState = useContext(store)\n  const { state } = globalState\n  const { shipData } = state\n  const [data, setData] = useState([])\n\n  useEffect(() => {\n    const decks = Object.keys(shipData)\n    const flatData = decks.map(deck => shipData[deck]).flat()\n\n    const peerGroupData = flatData.length !== 0 && Object.prototype.hasOwnProperty.call(flatData[0], 'category')\n\n    const data = flatData.map(row => {\n      const obj = {\n        deck: row.deck,\n        cabinNumber: row.cabinNumber,\n        bookingStatus: row.bookingStatus,\n        cabinCapacity: row.cabinCapacity,\n        bookedOccupancy: row.bookedOccupancy\n      }\n      if (peerGroupData) {\n        obj.category = row.category\n        obj.selectedPercent = row.selectedPercent\n        obj.peerGroupPercent = row.peerGroupPercent\n        obj.difference = row.difference\n      }\n      return obj\n    })\n\n    setData(data)\n  }, [shipData])\n\n  const generateCsv = () => {\n    const csvRows = []\n    const headers = Object.keys(data[0])\n    csvRows.push(headers.map(header => `\"${('' + header).replace(/\"/g, '\\\\\"')}\"`).join(','))\n\n    for (const row of data) {\n      csvRows.push(headers.map(header => `\"${('' + row[header]).replace(/\"/g, '\\\\\"')}\"`).join(','))\n    }\n\n    const csvData = csvRows.join('\\n')\n\n    const blob = new Blob([csvData], { type: 'text/csv' })\n    const url = window.URL.createObjectURL(blob)\n    const a = document.createElement('a')\n    a.setAttribute('hidden', '')\n    a.setAttribute('href', url)\n    a.setAttribute('download', 'shipData.csv')\n    document.body.appendChild(a)\n    a.click()\n    document.body.removeChild(a)\n  }\n\n  if (!data.length) return null\n\n  return (\n    <Download onClick={() => generateCsv()}>\n      <Icon icon=\"download\" />\n      Download CSV\n    </Download>\n  )\n}\n\nexport default CsvDownload\n"]},"metadata":{},"sourceType":"module"}