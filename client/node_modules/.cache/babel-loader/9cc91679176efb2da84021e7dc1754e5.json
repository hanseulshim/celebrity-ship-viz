{"ast":null,"code":"import _slicedToArray from\"/Users/hanseulshim/Projects/celebrity-ship-viz/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import _taggedTemplateLiteral from\"/Users/hanseulshim/Projects/celebrity-ship-viz/node_modules/@babel/runtime/helpers/esm/taggedTemplateLiteral\";function _templateObject(){var data=_taggedTemplateLiteral([\"\\n  background-color: #80cbc4;\\n  margin-left: auto;\\n  color: \",\";\\n  padding: 0.5em 2em;\\n  border-radius: 3px;\\n\\n  &:hover {\\n    cursor: pointer;\\n  }\\n\"]);_templateObject=function _templateObject(){return data;};return data;}import React,{useContext,useEffect,useState}from'react';import{store}from'context/store';import styled from'styled-components';import Icon from'components/common/Icon';var Download=styled.button(_templateObject(),function(props){return props.theme.black;});var CsvDownload=function CsvDownload(){var globalState=useContext(store);var state=globalState.state;var shipData=state.shipData;var _useState=useState([]),_useState2=_slicedToArray(_useState,2),data=_useState2[0],setData=_useState2[1];useEffect(function(){var decks=Object.keys(shipData);var flatData=decks.map(function(deck){return shipData[deck];}).flat();var peerGroupData=flatData.length!==0&&Object.prototype.hasOwnProperty.call(flatData[0],'category');var data=flatData.map(function(row){var obj={deck:row.deck,cabinNumber:row.cabinNumber,bookingStatus:row.bookingStatus,cabinCapacity:row.cabinCapacity,bookedOccupancy:row.bookedOccupancy};if(peerGroupData){obj.category=row.category;obj.selectedPercent=row.selectedPercent;obj.peerGroupPercent=row.peerGroupPercent;obj.difference=row.difference;}return obj;});setData(data);},[shipData]);var generateCsv=function generateCsv(){var csvRows=[];var headers=Object.keys(data[0]);csvRows.push(headers.map(function(header){return\"\\\"\".concat((''+header).replace(/\"/g,'\\\\\"'),\"\\\"\");}).join(','));var _iteratorNormalCompletion=true;var _didIteratorError=false;var _iteratorError=undefined;try{var _loop=function _loop(){var row=_step.value;csvRows.push(headers.map(function(header){return\"\\\"\".concat((''+row[header]).replace(/\"/g,'\\\\\"'),\"\\\"\");}).join(','));};for(var _iterator=data[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){_loop();}}catch(err){_didIteratorError=true;_iteratorError=err;}finally{try{if(!_iteratorNormalCompletion&&_iterator.return!=null){_iterator.return();}}finally{if(_didIteratorError){throw _iteratorError;}}}var csvData=csvRows.join('\\n');var blob=new Blob([csvData],{type:'text/csv'});var url=window.URL.createObjectURL(blob);var a=document.createElement('a');a.setAttribute('hidden','');a.setAttribute('href',url);a.setAttribute('download','shipData.csv');document.body.appendChild(a);a.click();document.body.removeChild(a);};if(!data.length)return null;return React.createElement(Download,{onClick:function onClick(){return generateCsv();}},React.createElement(Icon,{icon:\"download\"}),\"Download CSV\");};export default CsvDownload;","map":{"version":3,"sources":["/Users/hanseulshim/Projects/celebrity-ship-viz/src/components/main/filters/main-filters/CsvDownload.js"],"names":["React","useContext","useEffect","useState","store","styled","Icon","Download","button","props","theme","black","CsvDownload","globalState","state","shipData","data","setData","decks","Object","keys","flatData","map","deck","flat","peerGroupData","length","prototype","hasOwnProperty","call","row","obj","cabinNumber","bookingStatus","cabinCapacity","bookedOccupancy","category","selectedPercent","peerGroupPercent","difference","generateCsv","csvRows","headers","push","header","replace","join","csvData","blob","Blob","type","url","window","URL","createObjectURL","a","document","createElement","setAttribute","body","appendChild","click","removeChild"],"mappings":"sjBAAA,MAAOA,CAAAA,KAAP,EAAgBC,UAAhB,CAA4BC,SAA5B,CAAuCC,QAAvC,KAAuD,OAAvD,CACA,OAASC,KAAT,KAAsB,eAAtB,CACA,MAAOC,CAAAA,MAAP,KAAmB,mBAAnB,CACA,MAAOC,CAAAA,IAAP,KAAiB,wBAAjB,CAEA,GAAMC,CAAAA,QAAQ,CAAGF,MAAM,CAACG,MAAV,mBAGH,SAAAC,KAAK,QAAIA,CAAAA,KAAK,CAACC,KAAN,CAAYC,KAAhB,EAHF,CAAd,CAYA,GAAMC,CAAAA,WAAW,CAAG,QAAdA,CAAAA,WAAc,EAAM,CACxB,GAAMC,CAAAA,WAAW,CAAGZ,UAAU,CAACG,KAAD,CAA9B,CADwB,GAEhBU,CAAAA,KAFgB,CAEND,WAFM,CAEhBC,KAFgB,IAGhBC,CAAAA,QAHgB,CAGHD,KAHG,CAGhBC,QAHgB,eAIAZ,QAAQ,CAAC,EAAD,CAJR,wCAIjBa,IAJiB,eAIXC,OAJW,eAMxBf,SAAS,CAAC,UAAM,CACd,GAAMgB,CAAAA,KAAK,CAAGC,MAAM,CAACC,IAAP,CAAYL,QAAZ,CAAd,CACA,GAAMM,CAAAA,QAAQ,CAAGH,KAAK,CAACI,GAAN,CAAU,SAAAC,IAAI,QAAIR,CAAAA,QAAQ,CAACQ,IAAD,CAAZ,EAAd,EAAkCC,IAAlC,EAAjB,CAEA,GAAMC,CAAAA,aAAa,CAAGJ,QAAQ,CAACK,MAAT,GAAoB,CAApB,EAAyBP,MAAM,CAACQ,SAAP,CAAiBC,cAAjB,CAAgCC,IAAhC,CAAqCR,QAAQ,CAAC,CAAD,CAA7C,CAAkD,UAAlD,CAA/C,CAEA,GAAML,CAAAA,IAAI,CAAGK,QAAQ,CAACC,GAAT,CAAa,SAAAQ,GAAG,CAAI,CAC/B,GAAMC,CAAAA,GAAG,CAAG,CACVR,IAAI,CAAEO,GAAG,CAACP,IADA,CAEVS,WAAW,CAAEF,GAAG,CAACE,WAFP,CAGVC,aAAa,CAAEH,GAAG,CAACG,aAHT,CAIVC,aAAa,CAAEJ,GAAG,CAACI,aAJT,CAKVC,eAAe,CAAEL,GAAG,CAACK,eALX,CAAZ,CAOA,GAAIV,aAAJ,CAAmB,CACjBM,GAAG,CAACK,QAAJ,CAAeN,GAAG,CAACM,QAAnB,CACAL,GAAG,CAACM,eAAJ,CAAsBP,GAAG,CAACO,eAA1B,CACAN,GAAG,CAACO,gBAAJ,CAAuBR,GAAG,CAACQ,gBAA3B,CACAP,GAAG,CAACQ,UAAJ,CAAiBT,GAAG,CAACS,UAArB,CACD,CACD,MAAOR,CAAAA,GAAP,CACD,CAfY,CAAb,CAiBAd,OAAO,CAACD,IAAD,CAAP,CACD,CAxBQ,CAwBN,CAACD,QAAD,CAxBM,CAAT,CA0BA,GAAMyB,CAAAA,WAAW,CAAG,QAAdA,CAAAA,WAAc,EAAM,CACxB,GAAMC,CAAAA,OAAO,CAAG,EAAhB,CACA,GAAMC,CAAAA,OAAO,CAAGvB,MAAM,CAACC,IAAP,CAAYJ,IAAI,CAAC,CAAD,CAAhB,CAAhB,CACAyB,OAAO,CAACE,IAAR,CAAaD,OAAO,CAACpB,GAAR,CAAY,SAAAsB,MAAM,oBAAQ,CAAC,GAAKA,MAAN,EAAcC,OAAd,CAAsB,IAAtB,CAA4B,KAA5B,CAAR,QAAlB,EAAiEC,IAAjE,CAAsE,GAAtE,CAAb,EAHwB,8HAKbhB,CAAAA,GALa,aAMtBW,OAAO,CAACE,IAAR,CAAaD,OAAO,CAACpB,GAAR,CAAY,SAAAsB,MAAM,oBAAQ,CAAC,GAAKd,GAAG,CAACc,MAAD,CAAT,EAAmBC,OAAnB,CAA2B,IAA3B,CAAiC,KAAjC,CAAR,QAAlB,EAAsEC,IAAtE,CAA2E,GAA3E,CAAb,EANsB,EAKxB,kBAAkB9B,IAAlB,oHAAwB,SAEvB,CAPuB,qMASxB,GAAM+B,CAAAA,OAAO,CAAGN,OAAO,CAACK,IAAR,CAAa,IAAb,CAAhB,CAEA,GAAME,CAAAA,IAAI,CAAG,GAAIC,CAAAA,IAAJ,CAAS,CAACF,OAAD,CAAT,CAAoB,CAAEG,IAAI,CAAE,UAAR,CAApB,CAAb,CACA,GAAMC,CAAAA,GAAG,CAAGC,MAAM,CAACC,GAAP,CAAWC,eAAX,CAA2BN,IAA3B,CAAZ,CACA,GAAMO,CAAAA,CAAC,CAAGC,QAAQ,CAACC,aAAT,CAAuB,GAAvB,CAAV,CACAF,CAAC,CAACG,YAAF,CAAe,QAAf,CAAyB,EAAzB,EACAH,CAAC,CAACG,YAAF,CAAe,MAAf,CAAuBP,GAAvB,EACAI,CAAC,CAACG,YAAF,CAAe,UAAf,CAA2B,cAA3B,EACAF,QAAQ,CAACG,IAAT,CAAcC,WAAd,CAA0BL,CAA1B,EACAA,CAAC,CAACM,KAAF,GACAL,QAAQ,CAACG,IAAT,CAAcG,WAAd,CAA0BP,CAA1B,EACD,CApBD,CAsBA,GAAI,CAACvC,IAAI,CAACU,MAAV,CAAkB,MAAO,KAAP,CAElB,MACE,qBAAC,QAAD,EAAU,OAAO,CAAE,yBAAMc,CAAAA,WAAW,EAAjB,EAAnB,EACE,oBAAC,IAAD,EAAM,IAAI,CAAC,UAAX,EADF,gBADF,CAMD,CA9DD,CAgEA,cAAe5B,CAAAA,WAAf","sourcesContent":["import React, { useContext, useEffect, useState } from 'react'\nimport { store } from 'context/store'\nimport styled from 'styled-components'\nimport Icon from 'components/common/Icon'\n\nconst Download = styled.button`\n  background-color: #80cbc4;\n  margin-left: auto;\n  color: ${props => props.theme.black};\n  padding: 0.5em 2em;\n  border-radius: 3px;\n\n  &:hover {\n    cursor: pointer;\n  }\n`\n\nconst CsvDownload = () => {\n  const globalState = useContext(store)\n  const { state } = globalState\n  const { shipData } = state\n  const [data, setData] = useState([])\n\n  useEffect(() => {\n    const decks = Object.keys(shipData)\n    const flatData = decks.map(deck => shipData[deck]).flat()\n\n    const peerGroupData = flatData.length !== 0 && Object.prototype.hasOwnProperty.call(flatData[0], 'category')\n\n    const data = flatData.map(row => {\n      const obj = {\n        deck: row.deck,\n        cabinNumber: row.cabinNumber,\n        bookingStatus: row.bookingStatus,\n        cabinCapacity: row.cabinCapacity,\n        bookedOccupancy: row.bookedOccupancy\n      }\n      if (peerGroupData) {\n        obj.category = row.category\n        obj.selectedPercent = row.selectedPercent\n        obj.peerGroupPercent = row.peerGroupPercent\n        obj.difference = row.difference\n      }\n      return obj\n    })\n\n    setData(data)\n  }, [shipData])\n\n  const generateCsv = () => {\n    const csvRows = []\n    const headers = Object.keys(data[0])\n    csvRows.push(headers.map(header => `\"${('' + header).replace(/\"/g, '\\\\\"')}\"`).join(','))\n\n    for (const row of data) {\n      csvRows.push(headers.map(header => `\"${('' + row[header]).replace(/\"/g, '\\\\\"')}\"`).join(','))\n    }\n\n    const csvData = csvRows.join('\\n')\n\n    const blob = new Blob([csvData], { type: 'text/csv' })\n    const url = window.URL.createObjectURL(blob)\n    const a = document.createElement('a')\n    a.setAttribute('hidden', '')\n    a.setAttribute('href', url)\n    a.setAttribute('download', 'shipData.csv')\n    document.body.appendChild(a)\n    a.click()\n    document.body.removeChild(a)\n  }\n\n  if (!data.length) return null\n\n  return (\n    <Download onClick={() => generateCsv()}>\n      <Icon icon=\"download\" />\n      Download CSV\n    </Download>\n  )\n}\n\nexport default CsvDownload\n"]},"metadata":{},"sourceType":"module"}